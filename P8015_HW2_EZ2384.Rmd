---
title: "P8015_HW2_EZ2384"
output: github_document
---

#### Load package
```{r, message=FALSE}
library(tidyverse)
library(tidyr)
library(dplyr)
library(readxl)
```

#### Problem 1

```{r, echo=FALSE}
raw_data = read.csv("../../Datasets/NYC_Subway.csv")
```


```{r, message=FALSE}
# Read and clean NYC Subway Data
  Subway =  read_csv("../../Datasets/NYC_Subway.csv") %>% janitor::clean_names() %>% 
            subset(select=c(line, station_latitude, station_longitude, route1:route11, entrance_type, entry, vending, ada)) %>%
            mutate(entry=case_match(entry, "YES"~"TRUE", "NO"~"FALSE"))
```
##### Dataset Description
* **Variables**
  * Division, Line, Station Name,	Station Latitude, Station Longitude, Route1-11, Entrance Type, Entry,	Exit Only, Vending,
    Staffing, Staff Hours, ADA, ADA Notes, Free Crossover, North South Street, East West Street, Corner, Entrance Latitude,
    Entrance Longitude, Station Location, Entrance Location
* **Discussion on Variables**
  * This dataset provides comprehensive information about subway stations in NYC, including spatial details, the subway routes they serve, and      station amenities such as vending machines, ADA accessibility, and whether a free crossover is available.
* **Data Cleaning Steps so far**
  * Up to this point, I have firstly use the janitor package `clean_names` function to turn the dataset into a "nicer" format including
    turning all variable names into lowercase and replace the empty spaces between them with an underscore and etc. Then I utilized the
    `subset()` function to keep only variables of interest. Finally, I used `mutate()` in combination with `case_match()` to convert all
    instances of YES into TRUE and all instances of NO into FALSE within the entry column.
* **Dimension of the dataset is given by** `r nrow(raw_data)`x`r ncol(raw_data)`
* **The Dataset was originally NOT tidy**
  * Although each variable has its own column and each observation has its own row, there are still empty cells, which makes the dataset
    not tidy.
* **There are** `r nrow(distinct(raw_data,Station.Name))` **distinct stations**
* **There are** `r sum(Subway$ada=="TRUE")` **stations that are ADA-compliant**
* **Proportion of station entrances/exits without vending machines is given by** `r sum(Subway$vending=="NO")/sum(Subway$vending=="YES")`

**Transposition of Route1:Route11**
```{r}

Subway_Transposed = Subway %>% mutate(across(route1:route11, as.character)) %>% 
    # convert route1:route11 into character data types in order to perform the following transposition
    pivot_longer(
          cols = route1:route11,     # specify route1:route11 as original columns to transpose from
          names_to = "route_number", # column for original column names
          values_to= "route_name",   # column for original column values
          values_drop_na = TRUE      # exclude rows with NA values in "values_to" column
                )

```

```{r, echo=FALSE}
A_stations = Subway_Transposed %>% filter(route_name=="A") %>% distinct(line)
common = intersect(A_stations, Subway_Transposed %>% filter(ada=="TRUE") %>% distinct(line))
```

* **There are** `r count( A_stations )` **distinct stations serving the A train.**
  * **Of these serving the A train,** `r count(common)` **are ADA compliant.**

#### Problem 2

**Read-in Trash Wheel dataset sheets and clean the datasets**
```{r}
# Mr.Trash-Wheel
  mr_trash_wheel = read_excel("../../Datasets/Trash_Wheel.xlsx", range="A2:N587") %>% janitor:: clean_names() %>% mutate(sports_balls = round(as.numeric(sports_balls),0)) %>% filter(!is.na(dumpster))
# Prof.Trash-Wheel
  prof_trash_wheel = read_excel("../../Datasets/Trash_Wheel.xlsx", sheet=2, range="A2:M109") %>% janitor::clean_names() %>% filter(!is.na(dumpster))
# Gwynnda Trash-Wheel
  gwynnda_trash_wheel = read_excel("../../Datasets/Trash_Wheel.xlsx", sheet=4, range="A2:L159") %>% janitor::clean_names() %>% filter(!is.na(dumpster))
```

**Combine Datasets**
```{r}
# Firstly add an additional column specifying the DF origin
  mr_trash_wheel = mr_trash_wheel %>% mutate(source="Mr_Trash", year=as.numeric(year))
  prof_trash_wheel = prof_trash_wheel %>% mutate(source="Prof_Trash", year=as.numeric(year))
  gwynnda_trash_wheel = gwynnda_trash_wheel %>% mutate(source="Gwynnda_Trash", year=as.numeric(year))

  combined_trash = bind_rows(mr_trash_wheel, prof_trash_wheel, gwynnda_trash_wheel) %>% relocate(source, dumpster)
```

**Discussion on the Trash Wheel Dataset**

* Trash Wheel Excel File consists of 6 sheets, of which 4 contains trash wheel data and the rest contains explanatory information. For the trash wheel relevant sheets, each consists of descriptory columns such as
  * **Dumpster**: the dumpster number
  * **Year/Month/Date**: the datetime info for the trash collection
  * **Weight/Volume**: size and amount of trash collected at that specific collection task
  * **Plastic Bottles/Polystyrene/Cigarette Butts/Glass Bottles/Plastic Bags/Wrappers/Sports Balls**: different genres of trash collected at that specific collection task
  * **Homes Powered**: number of homes could be powered by converting the specific amount of trash at that collection task into electricity
* Number of observations in each dataframe after tidy processes:
  * **mr_trash_wheel**: 584 obs with 16 variables
  * **prof_trash_wheel**: 106 obs with 15 variables
  * **gwyna_trash_wheel**: 155 obs with 14 variables
  * **combined_trash**: 845 obs with 16 variables
* Total weight of trash collected by Professor Trash Wheel is given by: `r sum(prof_trash_wheel$weight_tons, na.rm=TRUE)`
* Total number of cigarette butts collected by Gwynnda in June of 2022 is given by: `r gwynnda_trash_wheel %>% filter(month=="June" & year==2022) %>% summarise(total = sum(cigarette_butts, rm.na=TRUE)) %>% pull(total)`

#### Problem 3


